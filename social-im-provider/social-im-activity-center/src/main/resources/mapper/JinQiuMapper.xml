<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.enuos.live.mapper.JinQiuMapper">
    
    <!--金秋送福详情反参-->
    <resultMap id="jinqiu" type="com.enuos.live.pojo.JinQiu">
        <result column="code" property="code" jdbcType="VARCHAR"/>
        <result column="title" property="title" jdbcType="VARCHAR"/>
        <result column="backgroundUrl" property="backgroundUrl" jdbcType="VARCHAR"/>
        <result column="startTime" property="startTime" jdbcType="VARCHAR"/>
        <result column="endTime" property="endTime" jdbcType="VARCHAR"/>
        <collection property="list" javaType="java.util.ArrayList" ofType="com.enuos.live.pojo.JackpotReward">
            <result column="suffix" property="sequence" jdbcType="INTEGER"/>
            <collection property="reward" resultMap="rewardMap"/>
        </collection>
    </resultMap>
    
    <!--奖励反参-->
    <resultMap id="rewardMap" type="java.util.Map">
        <result column="rewardCode" javaType="java.lang.String" property="rewardCode"/>
        <result column="rewardName" javaType="java.lang.String" property="rewardName"/>
        <result column="life" javaType="java.lang.Long" property="life"/>
        <result column="number" javaType="java.lang.Integer" property="number"/>
        <result column="suffix" javaType="java.lang.Integer" property="suffix"/>
        <result column="url" javaType="java.lang.String" property="url"/>
    </resultMap>
    
    <!--详情-->
    <select id="getDetail" parameterType="java.lang.String" resultMap="jinqiu">
        select
        t1.code,
        t1.title,
        t1.background_url backgroundUrl,
        t1.start_time startTime,
        t1.end_time endTime,
        
        t2.reward_code rewardCode,
        t2.life,
        t2.number,
        t2.suffix,
        t3.name rewardName,
        t3.url
        from tb_task t1
        left join tb_task_reward t2 on t2.task_code = t1.code
        left join tb_reward t3 on t3.code = t2.reward_code
        where t1.code = #{code}
        order by t2.suffix
    </select>
    
    <!--获取领奖记录-->
    <select id="getRewardRecord" resultType="java.util.Map">
        select
        code,
        date_format(create_time, '%Y-%m-%d') createTime
        from tb_task_reward_record
        where user_id = #{userId}
        <if test="codeList.size() > 0">
            and code in
            <foreach collection="codeList" item="code" open="(" separator="," close=")">
                #{code}
            </foreach>
        </if>
    </select>
</mapper>