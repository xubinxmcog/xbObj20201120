<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.enuos.live.mapper.WritMapper">
    
    <!--获取令状信息-->
    <select id="getWrit" resultType="com.enuos.live.pojo.Writ">
        select task_code, template_code, start_time, end_time from task where template_code = #{templateCode} and #{date} <![CDATA[>]]> start_time and #{date} <![CDATA[<]]> end_time
    </select>
    
    <!--获取排行榜-->
    <select id="getRankUser" resultType="java.lang.Long">
        select
        user_id
        from task_user
        where task_code = #{taskCode}
        order by integral desc
        limit #{limit}
    </select>
    
    <!--排行榜奖励-->
    <select id="getRankReward" resultType="java.util.Map">
        select
        t1.reward_code rewardCode,
        t1.life,
        t1.number,
        t1.suffix,
        t2.one_category_id categoryId
        from task_reward t1
        inner join product_info t2 on t2.product_code = t1.reward_code
        where t1.task_code = #{taskCode} and t1.template_code = #{templateCode}
        order by t1.suffix
    </select>
    
    <!--获取称号-->
    <select id="getTitle" resultType="com.enuos.live.pojo.Title">
        select
        id,
        title_code,
        user_id,
        expire_time
        from tb_user_title
        where user_id = #{userId} and title_code = #{titleCode}
    </select>
    
    <!--保存称号-->
    <insert id="saveTitle" parameterType="com.enuos.live.pojo.Title" useGeneratedKeys="true">
        insert into tb_user_title (user_id, title_code, expire_time) values (#{userId}, #{titleCode}, #{expireTime})
    </insert>
    
    <!--修改称号-->
    <update id="updateTitle" parameterType="com.enuos.live.pojo.Title">
        update tb_user_title
        <set>
            expire_time = #{expireTime}
        </set>
        where user_id = #{userId} and title_code = #{titleCode}
    </update>
</mapper>