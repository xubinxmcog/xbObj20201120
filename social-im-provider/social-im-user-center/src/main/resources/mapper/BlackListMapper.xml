<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.enuos.live.mapper.BlacklistMapper">

    <!--黑名单-->
    <select id="getBlacklist" parameterType="com.enuos.live.pojo.Blacklist" resultType="java.util.Map">
        select
        t1.id,
        t1.to_user_id userId,
        if(t2.id is null, 0, 1) isFriend,
        t2.remark,

        t3.nick_name nickName,
        t3.sex,
        t3.thumb_icon_url thumbIconUrl,

        t4.level
        from tb_user_blacklist t1
        left join tb_user_friend t2 on t2.friend_id = t1.to_user_id and t2.user_id = #{userId}
        inner join tb_user t3 on t3.user_id = t1.to_user_id
        inner join tb_user_account_attach t4 on t4.user_id = t1.to_user_id
        where t1.rating = #{rating} and t1.user_id = #{userId}
    </select>

    <!--是否存在黑名单关系-->
    <select id="isExists" resultType="java.lang.Integer">
        select 1
        from tb_user_blacklist
        <where>
            and user_id = #{userId}
            and to_user_id = #{toUserId}
            and rating = #{rating}
        </where>
        limit 1
    </select>

    <!--添加黑名单-->
    <insert id="save" parameterType="com.enuos.live.pojo.Blacklist" useGeneratedKeys="true">
        insert into tb_user_blacklist
        <trim prefix="(" suffix=")" suffixOverrides=",">
            user_id,
            to_user_id,
            rating
        </trim>
        <trim prefix="values(" suffix=")" suffixOverrides=",">
            #{userId},
            #{toUserId},
            #{rating}
        </trim>
    </insert>

    <!--解除黑名单-->
    <delete id="delete" parameterType="com.enuos.live.pojo.Blacklist">
        delete from tb_user_blacklist
        where user_id = #{userId} and to_user_id = #{toUserId} and rating = #{rating}
    </delete>

</mapper>